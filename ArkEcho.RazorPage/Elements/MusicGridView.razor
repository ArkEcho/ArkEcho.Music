
@inherits MusicDisplayBase

@inject Player player
@inject HTMLHelper helper
@inject NavigationManager navigation

<MudElement Class="overflow-auto px-4" Style="height: 79vh; width: 100vw;">
    <MudGrid Spacing="2" Justify="Justify.Center">
        @foreach (Album album in getFilteredAlbum())
        {
            <MudItem xs="6" sm="4" md="3" lg="2" xl="1" Style="max-width: 220px;">
                <MudPaper Class="pa-2" Style=@getAlbumCSS(album) Elevation="1">
                    <MudStack>
                        <MudImage Class="rounded-lg" Src="@(helper.GetBase64PngImg(album.Cover64))" Width="Resources.ImageSize" Height="Resources.ImageSize" ObjectFit="ObjectFit.Fill" />
                        <MudText Class="mb-n1" Typo="Typo.body2">@album.Name.Truncate(25)</MudText>
                        <MudText Class="my-n1" Typo="Typo.overline">@(getAlbumArtistNameTruncated(album, 25))</MudText>
                        <MudStack Row="true">
                            <MudStack>
                                <MudSpacer />
                                <MudText Class="my-n4" Typo="Typo.overline">@(album.MusicFiles.Count) Titel</MudText>
                                <MudSpacer />
                            </MudStack>
                            <MudIconButton Class="my-n4" OnClick="() => startMusicAlbum(album)" Icon="@Icons.Material.Rounded.PlayArrow" Color="Color.Default" />
                            <MudIconButton Class="my-n4" Icon="@Icons.Material.Rounded.List" OnClick="() => albumListClicked(album)" Color="Color.Default" />
                        </MudStack>
                    </MudStack>
                </MudPaper>
            </MudItem>
        }
    </MudGrid>
</MudElement>

@code {

    DialogOptions options = new DialogOptions() { FullWidth=true, MaxWidth= MaxWidth.ExtraExtraLarge, CloseButton = true, CloseOnEscapeKey = true };

    public class GridVirtualize
    {
        public List<Album> Elements { get; set; } = new List<Album>();
    }

    protected override async Task OnInitializedAsync()
    {
        player.TitleChanged += () => titleChanged();
        await base.OnInitializedAsync();
    }

    protected async Task titleChanged()
    {
        await InvokeAsync(StateHasChanged);
    }

    private string getAlbumCSS(Album album)
    {
        string result = string.Empty;
        if (player.PlayingFile?.Album == album.GUID)
            result += $"background-color: {Colors.Blue.Darken1};";
        return result;
    }

    private void albumListClicked(Album album)
    {
        navigation.NavigateTo($"/Music/{album.GUID}");
    }
}
