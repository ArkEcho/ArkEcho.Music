@page "/"

@layout LoginLayout

@inject IAppModel model
@inject NavigationManager NavigationManager

<MudItem >
    <MudTextField Label="Username" Variant="Variant.Outlined" MaxLength="24" @bind-Value="@username">Username</MudTextField>
</MudItem>

<MudItem>
    <MudTextField Label="Password" Variant="Variant.Outlined" MaxLength="24" @bind-Value="password" InputType="@PasswordInput" 
    Adornment="Adornment.End" AdornmentIcon="@PasswordInputIcon" OnAdornmentClick="passwordAdornmentClick" AdornmentAriaLabel="Show Password" />
</MudItem> 

<MudItem>
    <MudButton Variant="Variant.Filled" OnClick="validateUser">Login</MudButton>
</MudItem>

<MudItem>
    @LoginMesssage
</MudItem>

@code
{
    public string LoginMesssage { get; set; }

    private string username = string.Empty;
    private string password = string.Empty;
    
    bool isShow;
    InputType PasswordInput = InputType.Password;
    string PasswordInputIcon = Icons.Material.Filled.VisibilityOff;

    protected async override Task OnInitializedAsync()
    {
        if (await model.IsUserAuthenticated())
            NavigationManager.NavigateTo("/Player");
    }

    private async Task validateUser()
    {
        if (string.IsNullOrEmpty(username) || string.IsNullOrEmpty(password))
        {
            LoginMesssage = "Empty username or password";
            return;
        }

        if(await model.AuthenticateUser(username, password))
            NavigationManager.NavigateTo("/Player");            
        else
            LoginMesssage = "Username or password wrong";

        return;
    }

    void passwordAdornmentClick()
    {
        @if (isShow)
        {
            isShow = false;
            PasswordInputIcon = Icons.Material.Filled.VisibilityOff;
            PasswordInput = InputType.Password;
        }
        else
        {
            isShow = true;
            PasswordInputIcon = Icons.Material.Filled.Visibility;
            PasswordInput = InputType.Text;
        }
    }
}